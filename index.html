<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Mirror Dungeon Randomiser</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="page-layout">
    <!-- Left side nav -->
    <nav id="sideNav">
  <div class="side-nav-title">Quick navigation</div>

  <button type="button"
          class="side-nav-button"
          data-target="runSetupSection">
    Run setup
  </button>

  <button type="button"
          id="navShopTools"
          class="side-nav-button hidden"
          data-target="shopToolsSection">
    Shop tools
  </button>

  <button type="button"
          class="side-nav-button"
          data-target="runPresetsSection">
    Run presets
  </button>

  <button type="button"
          class="side-nav-button"
          data-target="settings">
    Owned IDs/EGOs
  </button>

  <button type="button"
          class="side-nav-button"
          data-target="saved-teams">
    Saved teams
  </button>
</nav>

    <!-- Main content -->
    <main id="mainContent">
      <h1>Mirror Dungeon Randomiser</h1>
  <!-- Run setup -->
  <section id="runSetupSection">
    <h2>Run setup</h2>

    <!-- Status text when setup is locked -->
    <p id="runLockedBadge" class="small-note hidden">
      Run in progress – run setup is locked until you press
      <strong>Run completed</strong> in the Shop tools section.
    </p>

    <!-- Wrapper around all the setup controls -->
    <div id="runSetupControls">

      <!-- Number of Sinners + toggle -->
      <div class="run-field-group">
        <label class="inline-toggle-label">
          <input type="checkbox" id="randomizeNumSinnersToggle" checked>
          Randomise number of Sinners (1–11); leave unchecked to randomise all 12 Sinners
        </label>

        <label>
          <span class="field-label">How many Sinners?</span>
          <select id="numSinners">
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
            <option value="6">6</option>
            <option value="7">7</option>
            <option value="8">8</option>
            <option value="9">9</option>
            <option value="10">10</option>
            <option value="11" selected>11</option>
          </select>
        </label>
      </div>

      <!-- Manual Sinner selection -->
      <div id="manualSinnerSelect" class="hidden">
        <label class="inline-toggle-label">
          <input type="checkbox" id="useManualSinnerSelection">
          <span id="manualSinnerHelpText">
            Select the Sinners you wish to randomise (leave unchecked if you want the randomiser to pick the Sinners for you)
          </span>
        </label>
        <div id="manualSinnerCheckboxes" class="sinner-select-grid"></div>
      </div>

      <!-- EGOs per Sinner + rank filter toggle -->
      <div class="run-field-group">
        <label>
          EGOs per Sinner (1–4):
          <select id="egosPerSinner">
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3" selected>3</option>
            <option value="4">4</option>
          </select>
        </label>

        <label class="inline-toggle-label">
          <input type="checkbox" id="randomizeEgoRanksToggle">
          Randomise certain ranks of EGO
        </label>
      </div>

      <!-- EGO rank filter (only visible when the above toggle is ON) -->
      <div id="egoRankFilterContainer" class="hidden">
        <p>Which EGO ranks can be randomised?</p>

        <label class="keyword-filter">
          <input type="checkbox" data-ego-rank="ZAYIN" id="egoRankZayin" checked>
          ZAYIN
        </label>
        <label class="keyword-filter">
          <input type="checkbox" data-ego-rank="TETH" id="egoRankTeth" checked>
          TETH
        </label>
        <label class="keyword-filter">
          <input type="checkbox" data-ego-rank="HE" id="egoRankHe" checked>
          HE
        </label>
        <label class="keyword-filter">
          <input type="checkbox" data-ego-rank="WAW" id="egoRankWaw" checked>
          WAW
        </label>
        <label class="keyword-filter">
          <input type="checkbox" data-ego-rank="ALEPH" id="egoRankAleph" disabled>
          ALEPH (not available yet)
        </label>

        <p class="small-note">
          Note: each Sinner always brings exactly one ZAYIN EGO. If ZAYIN is unchecked here,
          they will keep their base ZAYIN instead of randomising it.
        </p>
      </div>

      <!-- Shop rules for EGO Gifts -->
      <div class="run-field-group">
        <label class="inline-toggle-label">
          <input type="checkbox" id="enableGiftShopRule">
          Enable rule of selling all EGO Gifts when reaching a shop
        </label>

        <!-- Starts disabled; JS will enable it when the first rule is on -->
        <label class="inline-toggle-label" id="giftNoReacquireLabel">
          <input type="checkbox" id="enableGiftNoReacquireRule" disabled>
          Don't allow an EGO Gift to be re-obtained once sold off
        </label>
      </div>

      <div class="run-field-group">
        <label class="inline-toggle-label">
          <input type="checkbox" id="enableRandomiseSinnersEachShop">
          Randomise Sinners at each Shop
        </label>
      </div>

      <!-- Deployment order -->
      <div class="run-field-group">
        <label>
          <input type="checkbox" id="randomizeOrder">
          Randomise deployment order (1–7 on-field, rest support)
        </label>
      </div>

      <!-- Run + preset buttons -->
      <div class="run-buttons">
        <button id="randomizeRunBtn" class="btn-primary">Randomise Run</button>
        <button id="saveRunPresetBtn" class="btn-secondary hidden">
          Save latest randomiser settings as preset
        </button>
      </div>
      
    </div> <!-- end #runSetupControls -->

    <h3>Result</h3>
    <pre id="runResult"></pre>
    <button id="copyResultBtn" class="btn-secondary">Copy result to clipboard</button>
  </section>

<!-- Shop / EGO Gift tools (only visible when shop rules are enabled) -->
<section id="shopToolsSection" class="hidden">
  <h2>Shop / EGO Gift tools</h2>

  <p class="small-note" id="shopToolsRunNotice">
    A run is currently active with shop rules enabled. Use this panel to track
    EGO Gifts and (optionally) re-randomise Sinners at each shop. Press
    <strong>Run completed</strong> when you finish the run to unlock the setup again.
  </p>
<div id="shopRuleBadges" class="chip-row hidden">
  <span id="chipGiftRule" class="chip">Gift rule: Sell all gifts</span>
  <span id="chipNoReobtain" class="chip">No re-obtain: On</span>
  <span id="chipShopSinners" class="chip">Sinner rerolls at shop: On</span>
</div>

  <!-- EGO Gift tools -->
  <div id="egoGiftTools">
    <h3>EGO Gifts for this run</h3>

    <div id="egoGiftFilters">
      <label>
        Search by name:
        <input type="text" id="egoGiftSearchInput" placeholder="e.g. Hellterfly's Dream, Ashes to Ashes etc">
      </label>
      <button id="egoGiftClearSearchBtn">Clear search</button>

      <div id="egoGiftKeywordFilters">
        <p>Filter by keyword:</p>
        <label class="keyword-filter">
          <input type="checkbox" data-gift-keyword="burn"> Burn
        </label>
        <label class="keyword-filter">
          <input type="checkbox" data-gift-keyword="bleed"> Bleed
        </label>
        <label class="keyword-filter">
          <input type="checkbox" data-gift-keyword="tremor"> Tremor
        </label>
        <label class="keyword-filter">
          <input type="checkbox" data-gift-keyword="sinking"> Sinking
        </label>
        <label class="keyword-filter">
          <input type="checkbox" data-gift-keyword="rupture"> Rupture
        </label>
        <label class="keyword-filter">
          <input type="checkbox" data-gift-keyword="poise"> Poise
        </label>
        <label class="keyword-filter">
          <input type="checkbox" data-gift-keyword="charge"> Charge
        </label>
        <label class="keyword-filter">
          <input type="checkbox" data-gift-keyword="slash"> Slash
        </label>
        <label class="keyword-filter">
          <input type="checkbox" data-gift-keyword="blunt"> Blunt
        </label>
        <label class="keyword-filter">
          <input type="checkbox" data-gift-keyword="pierce"> Pierce
        </label>
        <label class="keyword-filter">
          <input type="checkbox" data-gift-keyword="keywordless"> Keywordless
        </label>
      </div>
    </div>

    <p id="egoGiftActiveFiltersText" class="small-note">
    No gift keyword filters active.
    </p>

    <div id="egoGiftLists">
      <div class="gift-list-column">
        <h4>Available EGO Gifts</h4>
        <p class="small-note">
          Click a gift here to mark that you currently have it on this floor.
        </p>
        <div id="egoGiftAvailableList" class="gift-list"></div>
      </div>

      <div class="gift-list-column">
        <h4>Currently selected this floor</h4>
        <p class="small-note">
          Click a gift again to remove it if you selected it by mistake.
        </p>
        <div id="egoGiftSelectedList" class="gift-list"></div>
      </div>

      <div class="gift-list-column">
        <h4>Locked / previously sold this run</h4>
        <p class="small-note">
          These cannot be picked again this run when the "no re-obtain" rule is on.
        </p>
        <div id="egoGiftBannedList" class="gift-list"></div>
      </div>
    </div>

    <button id="shopReachedBtn" class="btn-primary">
  Shop reached – sell all current EGO Gifts
</button>
    <p class="small-note">
      This clears the list of current gifts. If the "no re-obtain" rule is enabled,
      sold gifts are permanently locked for the rest of the run.
    </p>
  </div>

  <!-- Sinner-only "shop reached" button (shown when no EGO Gift rules are active) -->
  <button id="shopReachedSinnerOnlyBtn" class="btn-primary hidden">
  Shop reached – show Sinner randomise UI
</button>

  <!-- Sinner re-randomiser (only used when "Randomise Sinners at each Shop" is on) -->
  <div id="shopSinnerTools" class="hidden">
    <h3>Sinner re-randomiser for current shop</h3>
    <p class="small-note">
      These settings will lock again once
      <strong>"Randomise Sinners for this shop"</strong> is pressed, until the next
      time you click <strong>"Shop reached"</strong>.
    </p>

    <div class="run-field-group">
      <label>
        <span class="field-label">How many Sinners are you changing?</span>
        <select id="shopNumSinners">
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3" selected>3</option>
        </select>
      </label>
    </div>

    <p class="small-note">
  Pick up to <span id="shopSinnerLimitText">3</span> Sinners below to re-randomise
  their Identities for this shop.
  <span id="shopSinnerHint">
    You haven't selected anyone – the randomiser will pick all 3 Sinners at random.
  </span>
</p>

    <div id="shopSinnerSelect" class="sinner-select-grid">
      <!-- checkboxes are injected by main.js -->
    </div>

    <button id="randomizeShopSinnersBtn" class="btn-primary">
  Randomise Sinners for current shop
</button>
  </div>

  <button id="runCompletedBtn" class="btn-danger run-completed-btn">
  Run completed – unlock run setup
</button>
</section>

<!-- New section: saved run presets -->
<section id="runPresetsSection">
  <h2>Run presets</h2>
  <div class="preset-controls">
    <label>
      Preset name:
      <input type="text" id="runPresetNameInput" placeholder="e.g. 8 Sinners, Bleed/Tremor focus">
    </label>
    <button id="clearRunPresetsBtn" class="btn-danger">Clear all presets</button>
  </div>
  <div id="savedRunPresetsContainer">No presets saved yet.</div>
</section>


  <!-- Ownership settings -->
  <section id="settings">
  <h2>Owned IDs/EGOs</h2>
  <p>
    Tick the Identities and EGOs you own. Base LCB Identities and base ZAYIN EGOs
    are always available as a fallback.
  </p>

  <div id="ownershipSearchBar">
    <label>
      Search IDs / EGOs:
      <input
        type="text"
        id="ownershipSearchInput"
        placeholder="e.g. Yi Sang, Solemn Lament, Lantern"
      >
    </label>
    <button id="ownershipSearchBtn">Search</button>
    <button id="ownershipClearSearchBtn">Clear search</button>
  </div>

  <!-- NEW: keyword filter bar -->
  <div id="keywordFilterBar">
  <button id="toggleKeywordFiltersBtn">Filter by keyword</button>
  <span id="activeKeywordFiltersDisplay">No keyword filters active</span>
  <button id="clearKeywordFiltersBtn">Clear keyword filters</button>

  <div id="keywordFilters" class="hidden">
    <p>Select one or more keywords:</p>
    <label class="keyword-filter">
      <input type="checkbox" data-keyword="burn"> Burn
    </label>
    <label class="keyword-filter">
      <input type="checkbox" data-keyword="bleed"> Bleed
    </label>
    <label class="keyword-filter">
      <input type="checkbox" data-keyword="tremor"> Tremor
    </label>
    <label class="keyword-filter">
      <input type="checkbox" data-keyword="sinking"> Sinking
    </label>
    <label class="keyword-filter">
      <input type="checkbox" data-keyword="rupture"> Rupture
    </label>
    <label class="keyword-filter">
      <input type="checkbox" data-keyword="poise"> Poise
    </label>
    <label class="keyword-filter">
      <input type="checkbox" data-keyword="charge"> Charge
    </label>
    <label class="keyword-filter">
      <input type="checkbox" data-keyword="slash"> Slash
    </label>
    <label class="keyword-filter">
      <input type="checkbox" data-keyword="blunt"> Blunt
    </label>
    <label class="keyword-filter">
      <input type="checkbox" data-keyword="pierce"> Pierce
    </label>
  </div>
</div>

<button id="toggleSettings">Show / hide IDs/EGOs</button>
<button id="expandAllSinnersBtn" class="btn-secondary">Expand all Sinners</button>
<button id="collapseAllSinnersBtn" class="btn-secondary">Collapse all Sinners</button>
<button id="resetOwnershipBtn" class="btn-danger">Reset to LCB ID/base ZAYIN EGO only</button>
<button id="selectAllIdsBtn" class="btn-secondary">Select all IDs</button>
<button id="selectAllEgosBtn" class="btn-secondary">Select all EGOs</button>
<button id="selectAllOwnershipBtn" class="btn-secondary">Select all IDs/EGOs</button>

  <div id="ownershipContainer" class="hidden"></div>
</section>

  <!-- Saved teams -->
  <section id="saved-teams">
    <h2>Saved teams</h2>
    <label>
      Team name:
      <input type="text" id="saveTeamName" placeholder="e.g. Funny Bleed Run">
    </label>
    <button id="saveTeamBtn" class="btn-primary">Save current result</button>
<button id="clearTeamsBtn" class="btn-danger">Clear all saved teams</button>

    <div id="savedTeamsList"></div>
  </section>
</main>
  </div>

  <script src="data.js"></script>
  <script src="main.js"></script>
</body>
</html>
